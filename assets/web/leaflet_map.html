<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø®Ø±ÙŠØ·Ø© Ø³Ù„Ø·Ù†Ø© Ø¹ÙÙ…Ø§Ù† â€” Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>

  html, body { margin:0; height:100%; font-family: "Segoe UI", Tahoma, sans-serif; background:#fff; }

  #map { width:100%; height:100%; background:#fff; }

  /* Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: Ø®Ø· ØµØºÙŠØ± ÙˆÙ‡Ø§Ù„Ø© Ø®ÙÙŠÙØ© */

  .gov-label {

    font-weight: 600;

    font-size: 12px;           /* â† ÙƒØ¨Ø±/ØµØºØ± Ù‡Ù†Ø§ Ù„Ùˆ ØªØ¨ÙŠÙ† */

    color: #2b3a42;

    text-shadow: 0 0 2px #fff, 1px 1px 0 #fff, -1px -1px 0 #fff;

    white-space: nowrap;

    pointer-events: none;

  }
</style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>
<script>

  // Ø®Ø±ÙŠØ·Ø© Ø¨Ø¯ÙˆÙ† Ø·Ø¨Ù‚Ø© Ø¨Ù„Ø§Ø·Ø§Øª (Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡)

  const map = L.map('map', {

    center: [21.5, 57.5],

    zoom: 6,

    minZoom: 5,

    maxZoom: 12,

    attributionControl: false,

    zoomControl: true,

    preferCanvas: true

  });

  // ğŸ—‚ï¸ Ø¹Ø¯Ù‘Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§Ø± Ø­Ø³Ø¨ Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ù„Ù Ø¹Ù†Ø¯Ùƒ

  const GOV_GEOJSON_URL = 'oman_governorates.geo.json';

  // Ø­Ø¯ÙˆØ¯ ÙˆØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª

  const COLOR_LINE = '#637286';

  const COLOR_FILL = '#cfe0ff';

  const COLOR_FILL_HOVER = '#aecdff';

  let govLayer, labelMarkers = [];

  // Ø¥Ø²Ø§Ø­Ø§Øª Ù…Ø­Ø³Ù‘Ù†Ø© Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙŠ Ø£Ù…Ø§ÙƒÙ† Ù…Ù†Ø§Ø³Ø¨Ø©

  // (Ù‚ÙŠÙ…ÙŠ dx/dy Ù†Ø³Ø¨ÙŠØ©Ø› Ø²ÙŠØ¯ÙŠ/Ù‚Ù„Ù‘Ù„ÙŠ Ù„Ùˆ ØªØ¨ÙŠÙ† ØªØ­Ø±ÙŠÙƒ Ø¨Ø³ÙŠØ· Ù„ÙƒÙ„ Ù…Ø­Ø§ÙØ¸Ø©)

  const labelOffsets = {

    'muscat':            { dx:  0.22, dy: -0.08 },

    'musandam':          { dx:  0.02, dy: -0.10 },

    'alburaimi':         { dx:  0.00, dy: -0.05 },

    'addhahirah':        { dx: -0.08, dy:  0.02 },

    'adakhliyah':        { dx:  0.02, dy:  0.03 },

    'albatinahnorth':    { dx:  0.14, dy: -0.05 },

    'albatinahsouth':    { dx:  0.14, dy:  0.08 },

    'ashsharqiyahnorth': { dx:  0.18, dy: -0.05 },

    'ashsharqiyahsouth': { dx:  0.22, dy:  0.10 },

    'alwusta':           { dx:  0.08, dy:  0.14 },

    'dhofar':            { dx:  0.18, dy:  0.06 }

  };

  function normKey(s){ return (s||'').toString().toLowerCase().replace(/\s+/g,'').replace(/[-_']/g,''); }

  function renderLabels(geo){

    // Ø§Ù…Ø³Ø­ Ø§Ù„Ù‚Ø¯ÙŠÙ…

    labelMarkers.forEach(m => map.removeLayer(m));

    labelMarkers = [];

    geo.features.forEach(f=>{

      const nameAr = f.properties.NAME_1_AR || f.properties.NAME_1 || '';

      const c = turf.centroid(f);

      let [lng, lat] = c.geometry.coordinates;

      const key = normKey(f.properties.NAME_1);

      const off = labelOffsets[key];

      if (off){

        // Ù…Ø¶Ø±ÙˆØ¨ ÙÙŠ 0.5 Ù„Ù„ØªØ¯Ø±Ù‘Ø¬ Ø§Ù„Ù„Ø·ÙŠÙØ› Ø²ÙŠØ¯ÙŠ Ù„Ùˆ ØªØ¨ÙŠÙ† Ø¥Ø²Ø§Ø­Ø© Ø£Ù‚ÙˆÙ‰

        lng += off.dx * 0.5;

        lat += off.dy * 0.5;

      }

      const icon = L.divIcon({ className: 'gov-label', html: nameAr, iconSize: null });

      const m = L.marker([lat, lng], { icon, interactive:false }).addTo(map);

      labelMarkers.push(m);

    });

  }

  // Ø­Ù…Ù‘Ù„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª ÙˆØ§Ø±Ø³Ù…

  fetch(GOV_GEOJSON_URL)

    .then(r => r.json())

    .then(geo => {

      govLayer = L.geoJSON(geo, {

        style: () => ({ color: COLOR_LINE, weight: 1, fillColor: COLOR_FILL, fillOpacity: 0.35 }),

        onEachFeature: (f, layer) => {

          layer.on({

            mouseover: e => e.target.setStyle({ fillColor: COLOR_FILL_HOVER }),

            mouseout:  e => e.target.setStyle({ fillColor: COLOR_FILL })

          });

        }

      }).addTo(map);

      const b = govLayer.getBounds();

      map.fitBounds(b, { padding:[20,20] });

      map.setMaxBounds(b.pad(0.10));

      map.options.maxBoundsViscosity = 1.0;

      renderLabels(geo);

    })

    .catch(err => {

      console.error('GeoJSON load error:', err);

      alert('ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª. ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø± ÙˆØ§Ù„Ø§Ø³Ù….');

    });
</script>
</body>
</html>
 